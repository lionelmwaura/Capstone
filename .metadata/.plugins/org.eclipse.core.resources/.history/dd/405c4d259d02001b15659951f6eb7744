<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Admin</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- font awesome -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
 	
</head>
<body>
<jsp:include page="components/header.jsp"/>
<br>
<div class="container">

  			<div class="col-lg-10 text-center ">
              <h3>${msg} ${success}</h3>
              <p>Users</p>
              
              <table class="table">
                <tr class="text-info">
					 <th>#</th>
					 <th>Name</th>
					 <th>Email</th>
					 <th>Roles</th>
					 <th><i class="fa fa-edit"></i></th>
			    </tr>
			    <c:forEach var="item" items="${list}">
				<tr class="text-body">
					<td>${list.indexOf(item)+1}.
					<c:if test="${not empty user_account.image}">
		     			<img src="static/img/users/${user_account.id}/profile/${user_account.image}"
		      			style="width:150px; height:150px; border-radius: 50%;" class="img-responsive">		    
			 		</c:if>
					</td>	
					<td>${item.fName} ${item.lName} [${item.role}]</td>	
					<td>${item.email}</td>	
					<td>
						<form method="POST" action="editrole" >		    									
							<input type="hidden" name="id" value="${item.id}" />		    	 
							<select onchange="this.form.submit()" name="role" class="form-control">
							<option value="${item.role}">${item.role}</option>
							<option value="USER">USER </option>
							<option value="DBA">DBA</option>
							<option value="ADMIN">ADMIN</option>												  
						 </select>												
					 </form>
					</td>
					<td>
						<a href="deleteUser?id=${item.id}" onclick="confirmed(); return false;" ><i class="fa fa-trash text-danger" title="Delete ${item.fName} ${item.lName}"></i></a>
						<a href="#" data-toggle="modal" data-target="#edits${item.id}"><i class="fa fa-pencil"></i></a> 
					</td>
								
				</tr>
				</c:forEach>
				<tbody>
				</tbody>
				</table>
            </div>       
</div>
           
           
            <c:forEach var="item" items="${list}">
            <div class="modal fade" id="edits${item.id}">
					    <div class="modal-dialog modal-md">
						<div class="modal-content">	
						<div class="modal-header">
			                <h5 class="modal-">Edit User</h5>
			                <button type="button" data-dismiss="modal" aria-label="Close" class="close"><span aria-hidden="true">×</span></button>
			              </div>      
						<!-- Modal body -->
						<div class="modal-body">			    		
			    		  
			    		  <form:form action="updateUsers" modelAttribute="user" method="post">
			                  <div class="form-group">
			                    <label for="fn">Name</label>
			                    <form:input path="fName"  value="${item.fName}" class="form-control" placeholder="First Name"/>
			                    <form:input type="hidden" path="id" value="${item.id}" class="form-control" />
			                  </div>
			                  <div class="form-group">
			                    <label for="lname">Last Name</label>
			                    <form:input path="lName"  value="${item.lName}" class="form-control" placeholder="Last Name"/>			                    
			                  </div>
			                  <div class="form-group">
			                    <label for="role">Role</label>
			                    	<form:select path="role" class="form-control">
			                    	<option value="${item.role}">${item.role}</option>
			                    	<option value="USER">USER</option>
									<option value="DBA">DBA</option>
									<option value="ADMIN">ADMIN</option>
									</form:select>
			                  </div>
			                  <div>
			                    <button type="submit" class="btn btn-primary"><i class="fa fa-user"></i> Save</button>
			                    <button type="button" data-dismiss="modal" aria-label="Close" class="btn btn-danger">Close</button>
			                  </div>
			                </form:form>
			    		  
	                     </div>
					    </div>	
				      </div>
					  </div>
           			 </c:forEach>

    <script>
	    function confirmed(){
            if (confirm('You are about to delete, Do you want to proceed?')) {
                  document.getElementById("del").submit();
                  return true;
	            } else {
	               return false;
	            }
	         }
        	    
	    $("#searchnow").keyup(function () {
	        var value = this.value.toLowerCase().trim();

	        $("table tr").each(function (index) {
	            if (!index) return;
	            $(this).find("td").each(function () {
	                var id = $(this).text().toLowerCase().trim();
	                var not_found = (id.indexOf(value) == -1);
	                $(this).closest('tr').toggle(!not_found);
	                return not_found;
	            });
	        });
	    });


	   
	    </script>    
</body>
</html>