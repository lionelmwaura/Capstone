<%@ page language="java" contentType="text/html; charset=UTF-8"
pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
 
 <c:if test="${empty role or role ==null}">
 <c:redirect url="/login?error=Unauthorised Access for protected resource"/>
 </c:if>
  <c:if test="${role != 'DBA' and role != 'ADMIN'}">
    <c:redirect url="/profile?error=Access Denied"/>
 </c:if>


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<!-- Favicons Icon -->

<title>Capstone | Admin</title>

<!-- Mobile Specific -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- CSS Style -->
<link rel="stylesheet" type="text/css" href="static/css/internal.css">
<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="static/css/font-awesome.css" media="all">
<link rel="stylesheet" type="text/css" href="static/css/simple-line-icons.css" media="all">
<link rel="stylesheet" type="text/css" href="static/css/style.css" media="all">
<link rel="stylesheet" type="text/css" href="static/css/animate.css" media="all">
<link rel="stylesheet" type="text/css" href="static/css/revslider.css" >
<link rel="stylesheet" type="text/css" href="static/css/owl.carousel.css">
<link rel="stylesheet" type="text/css" href="static/css/owl.theme.css">
<link rel="stylesheet" type="text/css" href="static/css/flexslider.css">
<link rel="stylesheet" type="text/css" href="static/css/jquery.mobile-menu.css">

<!-- Google Fonts -->
<link href='https://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800,900' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300italic,300,600,600italic,400italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
</head>

<body class="inner-page">
<div id="page"> 
  
  <!-- Header -->
  <jsp:include page="components/header.jsp"/>
  <!-- end header --> 
  
  
  <!-- Main Container -->
  <section class="main-container col1-layout">
    <div class="main container">
      <div class="col-main">
        <div class="cart">
          <div class="page-title">
            <h1>${list.size()} ${msg} ${success} <span class="text-danger">${error}</span></h1>
             <form action="seachByemailOrlastname" method="post">
              <input id="searchnow" type="text" class="input-text required-entry" name="lName"  placeholder="Last name">
              <input type="email" name="email" class="input-text required-entry" placeholder="E-mail">
              <button type="submit" class="btn btn-danger">Search</button>
              </form>
          </div>
          <div class="table-responsive">
            <form method="post" action="#">
              <fieldset>
                <table class="data-table cart-table" id="shopping-cart-table">
                  <thead>
                    <tr class="first last">
                      <th rowspan="1">&nbsp;</th>
                      <th rowspan="1"><span class="nobr"><i class="fa fa-users"></i> Users </span></th>
                      <th rowspan="1" class="hidden-phone"><span class="nobr"> <i class="fa fa-envelope"></i> Email</span></th>
                      <th colspan="1" class="a-center"><span class="nobr"><i class="fa fa-key"></i> Role</span></th>
                      <th class="a-center " rowspan="1"> <i class="fa fa-times"></i> Delete </th>                      
                    </tr>
                  </thead>
                  
                  <tbody>
                    <c:forEach var="item" items="${list}">
                    <tr class="first odd">
                      <td class="image">
                      <c:if test="${not empty item.image}">
                      <a class="product-image" title="" href="#"><img width="75" height="75" alt="" src="static/img/users/${item.id}/profile/${item.image}"></a>
                      </c:if>
                      </td>
                      <td><h2 class="product-name">  ${item.fName} ${item.lName}  <a href="#" data-toggle="modal" data-target="#edits${item.id}"  title="Edit User" class="edit-bnt" href="#"></a></h2></td>
                       <td class="a-center hidden-table">${item.email} <a href="deleteByemail?email=${item.email}"><i class="fa fa-times"></i></a></td>
                      <td class="a-center hidden-table">
                      <form method="POST" action="editrole" >		    									
							<input type="hidden" name="id" value="${item.id}" />		    	 
							<select onchange="this.form.submit()" name="role"  class="input-text required-entry" required>
							<option value="">
							<c:forEach var="r" items="${item.getRoles()}">
				    		 ${r.role}
				    	    </c:forEach>
							</option>
							<option value="USER">USER </option>
							<option value="DBA">DBA</option>
							<option value="ADMIN">ADMIN</option>												  
						 </select>												
					 </form>

  </td>
                      <td class="a-center last">
                      <a class="button remove-item" title="Remove item" href="deleteUser?id=${item.id}" onclick="confirmed(); return false;"><span><span>Remove item</span></span></a></td>
                    </tr>
                    </c:forEach>
                  </tbody>
                </table>
              </fieldset>
            </form>
          </div>
          <!-- BEGIN CART COLLATERALS -->
          
          
          <!--cart-collaterals--> 
          
        </div>
      </div>
    </div>
  </section>
  <hr>
  
  <c:forEach var="item" items="${list}">
            <div class="modal fade" id="edits${item.id}">
    <div class="modal-dialog modal-sm">
<div class="modal-content">
<div class="modal-header">
                <h5 class="modal-">Edit User</h5>
                <button type="button" data-dismiss="modal" aria-label="Close" class="close"><span aria-hidden="true">Ã—</span></button>
              </div>      
<!-- Modal body -->
<div class="modal-body">
<form:form action="updateUsers" modelAttribute="user" method="post" id="form-validate" >
               
                  <input name="id" type="hidden" value="${item.id}" >
                 
                  <ul class="form-list">
                    <li class="fields">
                      <div class="customer-name">
                        <div class="input-box name-firstname">
                          <label for="firstname">Name<span class="required">*</span></label>
                          <div class="input-box1">
                            <form:input path="fName"  value="${item.fName}" class="input-text" placeholder="First Name"/>
                          </div>
                        </div>
                        <div class="input-box name-lastname">
                          <label for="lastname">Type <span class="required">*</span></label>
                          <div class="input-box1">
                            <form:input path="lName"  value="${item.lName}" class="input-text" placeholder="Last Name"/>
                          </div>
                          <form:input type="hidden" path="email" value="${item.email}" class="input-text" />
                        </div>
                        <div class="input-box name-lastname">
                          <label for="lastname">Please select Roles <span class="required">*</span></label>
                         <br>
                          <form:select path="role" class="validate-select" defaultvalue="${item.role}">
                    <option value="${item.role}">${item.role}</option>
                    <option value="USER">USER</option>
<option value="DBA">DBA</option>
<option value="ADMIN">ADMIN</option>
  </form:select>
 
                        </div>
                        
                        
                      </div>
                    </li>
                  </ul>
                                
                <div class="buttons-set">
                  <p class="required">* Required Fields</p>
                  <button type="submit" title="Save" class="btn btn-info"><span>Save</span></button>
                  <button type="button" data-dismiss="modal" aria-label="Close" class="btn btn-danger">Close</button>                   
                </div>
              </form:form>
             
     
                     </div>
    </div>
      </div>
  </div>
            </c:forEach>
 
  <!-- Footer -->  
  <jsp:include page="components/footer.jsp"/>
</div>

<!-- JavaScript --> 
<script type="text/javascript" src="static/js/jquery.min.js"></script> 
<script type="text/javascript" src="static/js/bootstrap.min.js"></script> 
<script type="text/javascript" src="static/js/parallax.js"></script> 
<script type="text/javascript" src="static/js/common.js"></script> 
<script type="text/javascript" src="static/js/jquery.flexslider.js"></script> 
<script type="text/javascript" src="static/js/owl.carousel.min.js"></script> 
<script type="text/javascript" src="static/js/jquery.mobile-menu.min.js"></script> 
<script type="text/javascript" src="static/js/cloud-zoom.js"></script>

<script>
        function confirmed(){
            if (confirm('You are about to delete, Do you want to proceed?')) {
                  document.getElementById("del").submit();
                  return true;
            } else {
               return false;
            }
         }
            
    $("#searchnow").keyup(function () {
        var value = this.value.toLowerCase().trim();

        $("table tr").each(function (index) {
            if (!index) return;
            $(this).find("td").each(function () {
                var id = $(this).text().toLowerCase().trim();
                var not_found = (id.indexOf(value) == -1);
                $(this).closest('tr').toggle(!not_found);
                return not_found;
            });
        });
    });
    </script>
</body>
</html>